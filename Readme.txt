ОБУЧЕНИЕ С УЧИТЕЛЕМ: КАЧЕСТВО МОДЕЛИ

Интернет-магазин «В один клик» продаёт разные товары: для детей, для дома, мелкую бытовую технику, косметику и даже продукты. 
Отчёт магазина за прошлый период показал, что активность покупателей начала снижаться.
Привлекать новых клиентов уже не так эффективно: о магазине и так знает большая часть целевой аудитории.
Возможный выход — удерживать активность постоянных клиентов. Сделать это можно с помощью персонализированных предложений.

«В один клик» — современная компания, поэтому её руководство не хочет принимать решения просто так — только на основе анализа данных и бизнес-моделирования. 
У компании есть небольшой отдел цифровых технологий, и вам предстоит побыть в роли стажёра в этом отделе.


ЦЕЛЬ ИССЛЕДОВАНИЯ

Поручено разработать решение, которое позволит персонализировать предложения постоянным клиентам, чтобы увеличить их покупательскую активность.
    
Бизнес задача:
1. Нужно промаркировать уровень финансовой активности постоянных покупателей. 
   В компании принято выделять два уровня активности: «снизилась», если клиент стал покупать меньше товаров, и «прежний уровень».
2. Нужно собрать данные по клиентам по следующим группам:
    - Признаки, которые описывают коммуникацию сотрудников компании с клиентом.
    - Признаки, которые описывают продуктовое поведение покупателя. Например, какие товары покупает и как часто.
    - Признаки, которые описывают покупательское поведение клиента. Например, сколько тратил в магазине.
    - Признаки, которые описывают поведение покупателя на сайте. Например, как много страниц просматривает и сколько времени проводит на сайте.

DataScience задача:
1. Нужно построить модель, которая предскажет вероятность снижения покупательской активности клиента в следующие три месяца.
2. В исследование нужно включить дополнительные данные финансового департамента о прибыльности клиента: какой доход каждый покупатель приносил компании за последние три месяца.
3. Используя данные модели и данные о прибыльности клиентов, нужно выделить сегменты покупателей и разработать для них персонализированные предложения.


ОБЩИЙ ВЫВОД

1. Интернет-магазин «В один клик» предоставил данные в 4 файлах с целью разработки решения, 
которое позволит персонализировать предложения постоянным клиентам, чтобы увеличить их покупательскую активность. 
Объём данных:
    - о поведении покупателя и о коммуникациях с ним: 1 300 объектов и 13 признаков
    - о выручке: 3 900 строк и 3 колонки
    - о времени, проведённом на сайте: 2 600 строк и 3 колонки
    - о среднемесячной прибыли: 1 300 объектов и 2 признака

2.  В процессе предобработки данных было:
    - наименования колонок приведены к нижнему регистру, пробелы заменены на нижние подчеркивания
    - пропусков не обнаружено
    - колонки с 64-битными числовыми значениями в 32-битные для оптимизации использования памяти
    - символ десятичного разделителя исправлен для колонки "прибыль" датасета df_money
    - явных дубликатов, требующих дополнительной обработки не обнаружено
    - обнаружены и устранены аномалии в категориальных столбцах

3.  Предобработка не потребовала удаления информации, потому 100% данных представлено к дальнейшему анализу.

4.  Результат исследовательского анализа:
    - целевой признак `покупательская_активность` имеет несбалансированное расспределение
    - данные в колонках `маркет_актив_тек_мес`, `средний_просмотр_категорий_за_визит` можно рассматривать как категориальные (порядковые)
    - `акционные_покупки` - признак преобразован в номинальный и разделён на 2 категории: до 0.5 и более 0.5
    - `выручка` - убраны выбросы: 1 объект с выручкой 106,862.20 и 6 объектов с выручкой 0
    - в данных нет клиентов, которые не совершали покупок за последние 3 месяца
    - количественные признаки с малой дисперсией не выявлены, значит нет необходимости заранее отбирать признаки методом фильтрации.
    - покупательская активность снизилась больше у клиентов с премиум типом сервиса
    - клиенты с премиумом сервисом чаще разрешают присылать дополнительные предложения о товаре
    - клиенты со стандартным сервисом зарегистрировались в сервисе позже, т.е. премиум клиенты пользуются онлайн магазином дольше
    - в распределении популярных категорий к покупке практически паритет, но доля "Косметики и аксессуаров" премиум клиентов заметно выше стандартного типа:  21% к 16% соответственно
    - клиенты стандартного типа сервиса чаще смотрят 5-6 категорий, чем премиум клиенты. Это можно объяснить периодом знакомства с сайтом и ассортиментом магазина
    - распределение выручки и прибыли практически совпадает, т.е. с точки зрения «В один клик» разница в типе сервиса не даёт оснований разделять клиентов на 2 страты

5. Корреляционный анализ показал, что Наибольшую корреляцию демонстрируют столбцы `текущий_мес_выручка` и `предыдущий_мес_выручка`. 
Такая тесная взаимосвязь двух признаков скорее объясняется постоянством покупательского поведения клиентов. 
Согласно шкале Чеддока значение 0.87 является высоким. Принято говорить о мультиколлинеарности при значениях выше 0.9 (или по шкале Чеддока "весьма высоких").
Также отметим, что остальные признаки слабо коррелируют как с целевым признаком, так и друг с другом. 
Отсутствие сильной взаимосвязи покупательской активности с другими признаками говорит, что нет утечки данных.

6. Для поиска лучшей модели была выполнена подготовка данных с помощью пайплайнов с использованием ColumnTransformer. 
Количественные и категориальные данные обработаны в пайплайне раздельно. Целевой признак закодирован при помощи LabelEncoder(). 
Под классом **1** понимается, что покупательская активность **снизится**, соответственно, **0** - **останется прежней**. 
Поиск лучшей модели осуществлялся с применением автоматизированного подхода GridSearchCV к следующим моделям: 
KNeighborsClassifier(), DecisionTreeClassifier(), LogisticRegression(), SVC(). 
Для каждой модели использовались разные комбинации способов кодирования, масштабирования и гиперпараметров. 
Выбрана метрика ROC-AUC, так как она лучше оценит качество модели при несбалансированных данных, 
а также она рабоатет более обобщённо, независимо от того, какой порог классификации выбран.
В итоге, лучшая метрика получена у модели SVC c ядром "rbf" и способом масштабирования StandardScaler(). 
Качество модели при кросс-валидации 91,4%. Рассчёт метрики "ROC-AUC" на тестовой выборке дал результат порядка 90,5%.

7. Анализ важности признаков выполненм с применением селектора селектора SelectKBest(). 
Согласно результатам анализа мы можем получить максимальное значение метрики ROC-AUC, рассчитанное на тестовой выборке, равно 91,36% при 13 признаках.

    Список лучших признаков:
    - 'акционные_покупки_до 0.5',
    - 'популярная_категория_Косметика и аксессуары',
    - 'популярная_категория_Мелкая бытовая техника и электроника',
    - 'популярная_категория_Техника для красоты и здоровья',
    - 'популярная_категория_Товары для детей',
    - 'маркет_актив_6_мес',
    - 'средний_просмотр_категорий_за_визит',
    - 'неоплаченные_продукты_штук_квартал',
    - 'ошибка_сервиса',
    - 'страниц_за_визит',
    - 'предпредыдущий_мес_выручка',
    - 'предыдущий_мес_минут',
    - 'текущий_мес_минут'

   Список наименее важных признаков:
    - 'текущий_мес_выручка',
    - 'разрешить_сообщать_нет',
    - 'популярная_категория_Кухонная посуда',
    - 'длительность',
    - 'тип_сервиса_стандарт',
    - 'предыдущий_мес_выручка',
    - 'маркет_актив_тек_мес'

   Интерпретация важности признаков проведена методами Permutation importance и SHAP:
    - cамым значимым признаком является `страниц_за_визит`. Чем он ниже, тем вероятнее, что клиент станет делать покупки реже
    - чем меньше время, проведённое на сайте, тем чаще модель присвоет объекту значение 1. 
	Этот вывод исходит из 2 и 3 места по значимости для признаков `предыдущий_мес_минут` и `текущий_мес_минут` соответственно
    - значение неоплаченных товаров в корзине покупателя `неоплаченные_продукты_штук_квартал` действует обратно: 
	чем их меньше, тем уровень покупательской активности можно классифицировать прежним. 
	Стоит отметить, что редкие, но высокие значения неоплаченных товаров в корзине дают самые высокие значения Шепли в сторону класса 1.
    - признаки `средний_просмотр_категорий_за_визит`, `маркет_актив_6_мес` и `предпредыдущий_мес_выручка` имеют схожее влияние на результат классификации. 
	Их высокие значения говорят о сохранении уровня покупательской активности
    - если доля акционных товаров в покупках клиентов более 50%, то скорее всего покупательская активность снизится. 
	Это может говорить о том, что такие клиенты скорее всего ищут определённый товар и только по акции, 
	т.е. магазин не может рассчитывать на таких клиентов как стабильно приносящих выручку, либо меры стимулирования сбыта оказались не такими разнообразными
    - клиенты с популярной категорией "Мелкая бытовая техника и электроника" чащ сохраняют свою покупательскую активность
    - признак `ошибка_сервиса` уже имеет слабое влияние на присвоение класса объекту

8. Выполнено сравнение `сегмента клиентов с высокой вероятностью снижения покупательской активности и наиболее высокой прибыльностью` с данными о всех клиентах. 

    Отличительные особенности сегмента как индикаторы снижения покупательской активности по сравнению с остальными клиентами:
    - среднее количество страниц, просмотренных за один визит на сайт за последние 3 месяца, ниже
    - время, проведённое на сайте в текущем и предыдущем периодах, ниже
    - среднее количество категорий, просмотренных за визит в течение последнего месяца, ниже
    - общее число неоплаченных товаров в корзине за последние 3 месяца выше
    - среднемесячное значение маркетинговых коммуникаций компании, которое приходилось на покупателя за последние 6 месяцев, ниже
    - выручка за позапрошлый период ниже
    - среднемесячная доля приобретённых акционных товаров за последние 6 месяцев больше 50% выше, чем у других покупателей
    - имеют популярные категории "Товары для детей", "Косметика и аксессуары" и "Кухонная посуда"

   Предложения по работе с сегментом для увеличения покупательской активности:
    - проведение дополнительного анализа с целью выяснения почему клиенты сегмента просматривают меньше страниц и меньше проводят времени на сайте за визит
    - провести опрос группы клиентов какие ещё категории товаров им были бы интересны. Это позволит увеличить количество просматриваемых категорий за визит
    - улучшить/доработать функционал сайта для стимулирования клиента к оформлению заказов, хранящихся неполаченными в корзине
    - предлагать индивидуальные акции/скидки на товары
    - увеличить ассортимент товаров, улучшить качество товаров (через работу/отбор поставщиков), 
	собрать обратную связь о товарах из категорий "Товары для детей", "Косметика и аксессуары" и "Кухонная посуда"
